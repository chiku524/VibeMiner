# Cloudflare Workers configuration for VibeMiner (vibeminer.tech)
#
# Cloudflare resource IDs (D1, KV) are set below. R2 uses bucket name.
# account_id: set via env CLOUDFLARE_ACCOUNT_ID (required for deploy and for local wrangler commands like d1 execute).
# CI sets it from the repo secret. Locally: add CLOUDFLARE_ACCOUNT_ID to apps/web/.env or export it.

name = "vibeminer"
main = ".open-next/worker.js"
compatibility_date = "2024-11-11"
compatibility_flags = ["nodejs_compat"]

[vars]
NEXT_PUBLIC_APP_URL = "https://vibeminer.tech"
# Fallback for /download when GitHub API fails. Update when cutting a new desktop release.
NEXT_PUBLIC_DESKTOP_DOWNLOAD_WIN = "https://github.com/chiku524/VibeMiner/releases/download/v1.0.18/VibeMiner-Setup-1.0.18.exe"
NEXT_PUBLIC_DESKTOP_DOWNLOAD_MAC = "https://github.com/chiku524/VibeMiner/releases/download/v1.0.18/VibeMiner-1.0.18-arm64.dmg"
NEXT_PUBLIC_DESKTOP_DOWNLOAD_LINUX = "https://github.com/chiku524/VibeMiner/releases/download/v1.0.18/VibeMiner-1.0.18.AppImage"

# Static assets: run_worker_first = false so asset requests are NOT billed as Worker invocations.
# Only document/API requests hit the Worker. (Default is false; set explicitly to avoid rate limits.)
[assets]
directory = ".open-next/assets"
binding = "ASSETS"
run_worker_first = false

# D1 Database (vibeminer-db, region ENAM)
[[d1_databases]]
binding = "DB"
database_name = "vibeminer-db"
database_id = "70339ee5-4d00-4c63-b829-c075bb37c025"

# KV Namespace (SESSIONS)
[[kv_namespaces]]
binding = "KV"
id = "a6b29305a6794e35a9a3b83bbd511d06"

# R2 Bucket - create with: npx wrangler r2 bucket create vibeminer-storage
[[r2_buckets]]
binding = "R2"
bucket_name = "vibeminer-storage"
